async function init(){try{param_userId||(updateMarkers(),isHomeWorldViewScrollEnable=!1),isInitCompleted=!0,window.dispatchEvent(myInitCompletedEvent),setAppStatus(appStatusMap[2])}catch(e){throw setAppStatus(appStatusMap[3]),e}}function getMarkerScale(){return((myearth.zoomMax-myearth.zoom+.3)/2).toFixed(2)}async function startPreviewMode(){myearth.autoRotate=!0,(window.innerWidth>screenWidthLimitMax||window.innerWidth<=screenWidthLimitMax&&!document.body.classList.contains("place-list-open"))&&(myearth.isPreviewMode=!0,document.getElementById("myearth").addEventListener("click",stopPreviewMode,!1),document.getElementById("myearth").addEventListener("touchstart",stopPreviewMode,!1))}function stopPreviewMode(){myearth.autoRotate=!1,myearth.isPreviewMode=!1,document.getElementById("myearth").removeEventListener("click",stopPreviewMode,!1),document.getElementById("myearth").removeEventListener("touchstart",stopPreviewMode,!1)}function startOpeningPhoto(){myearth.isOpeningPhoto=!0,window.dispatchEvent(new CustomEvent("openingPhoto"))}function finishOpeningPhoto(){myearth.isOpeningPhoto=!1}function startClosingPhoto(){myearth.isClosingPhoto=!0,window.dispatchEvent(new CustomEvent("closingPhoto"))}function finishClosingPhoto(){myearth.isClosingPhoto=!1}async function changeMorningNight(){let e;switch(morningNight){case morningNightMap[1]:e=morningNightMap[2];break;case morningNightMap[2]:e=morningNightMap[3];break;case morningNightMap[3]:e=morningNightMap[0];break;default:e=morningNightMap[1]}setMorningNight(e),updateMarkers()}async function changeView(){let e;switch(viewType){case viewTypeMap[1]:e=viewTypeMap[3];break;case viewTypeMap[3]:default:e=viewTypeMap[1]}setView(e),await updateMarkers()}async function newExperienceClick(){window.location.href="/InsertExperience"+(morningNight?"?MorningNightEnum="+morningNightMap.findIndex(e=>e==morningNight):"")}function startWorldView(){isFirstHomeView=!1,document.getElementById("world-body-container").scrollIntoView({behavior:"smooth"}),setWorldView(),isFirstWorldView&&(param_userId?changeView():updateMarkers(),isFirstWorldView=!1)}function setWorldView(){document.body.classList.remove("home-view"),document.body.classList.add("world-view")}function startHomeView(){window.scrollTo({top:0,behavior:"smooth"}),setHomeView(),closePopup("home-popup"),isFirstHomeView=!1}function setHomeView(){document.body.classList.remove("world-view"),document.body.classList.add("home-view"),closeExperiencePlacesClick()}function setHomeWorldViewSize(){let e=document.body.offsetHeight,t=document.body.offsetWidth;document.getElementById("home-body-container")&&(document.getElementById("home-body-container").style.height=e+"px",document.getElementById("home-body-container").style.width=t+"px"),document.getElementById("world-body-container")&&(document.getElementById("world-body-container").style.height=e+"px",document.getElementById("world-body-container").style.width=t+"px")}async function updateMarkers(){try{setAppStatus(appStatusMap[1]),stopPreviewMode();let e,t,i,o,a=document.getElementById("place-list-container"),r=document.getElementById("experience-list-container"),n=document.getElementById("user-list-container"),s=a.querySelector(".list-container"),l=r.querySelector(".list-container"),c=n.querySelector(".list-container"),d=a.querySelector(".flag-container"),m=r.querySelector(".flag-container"),u=morningNight?morningNightMap.indexOf(morningNight):0,p=document.getElementById("experience-search").value,h=document.getElementById("search-button");resetMarkers(),p?h.classList.add("more"):h.classList.remove("more");let y="",g="";param_userId&&viewType==viewTypeMap[3]&&(o=!0,y="[ToDo]"),g=morningNight&&morningNight>morningNightMap[0]?"["+morningNight+"]":"",d.innerHTML=y+" "+g,m.innerHTML=y+" "+g,s.innerHTML="<small class='noresult'>Loading...</small>",l.innerHTML="<small class='noresult'>Loading...</small>",c.innerHTML="<small class='noresult'>Loading...</small>",e=await GetPlaceList(u,p,o,!0,0,5),s.innerHTML="",!e||e.length<=0?s.innerHTML+="<small class='noresult'>No <b>Places</b> found! Come on! Go and explore the world! Try to search in <a href='/Search/Places'>Search Global Places</a></small>":addMarkers(e,s,0,o),t=await GetExperienceList(null,u,o,p,!1,!0,0,5),l.innerHTML="",!t||t.length<=0?l.innerHTML+="<small class='noresult'>No <b>Experiences</b> found! Come on! Go and explore the world! Try to search in <a href='/Search/Experiences'>Search Global Experiences</a></small>":addMarkers(t,l,1,o),i=param_userId?await GetUserFriendListByUser(param_userId,p,!1,!0,0,5):await GetUserList(p,!1,!0,0,5),c.innerHTML="",!i||i.length<=0?c.innerHTML+="<small class='noresult'>There is no <b>People</b> with this description! Try to search in <a href='/Search/People'>Search Global People</a></small>":addMarkers(i,c,2,o),markerList[0]&&(window.innerWidth>screenWidthLimitMax||window.innerWidth<=screenWidthLimitMax&&!document.body.classList.contains("place-list-open")?(await openPhoto(markerList[0],markerList[0].isToDo,markerList[0].type),window.dispatchEvent(new CustomEvent("startPreviewMode"))):myearth.goTo(markerList[0].location,{relativeDuration:100,approachAngle:5})),setAppStatus(appStatusMap[2])}catch(e){throw document.getElementById("place-list-container").innerHTML="<small class='noresult error-color'>There is an error! I don t know why! Try to <a href='javascript:window.location.reload(true)' title='Reload page'>reload the page</a></small>",appStatus==appStatusMap[1]&&setAppStatus(appStatusMap[2]),e}}function resetMarkers(){closePhoto();let e=document.getElementById("place-list-container"),t=document.getElementById("experience-list-container"),i=document.getElementById("user-list-container");markerList.forEach(e=>{e.removeEventListener("click"),e.animate("scale",0,{duration:200}),e.remove()}),markerList=[],placeList.forEach(e=>{e.removeEventListener("click",()=>{})}),placeList=[],e.querySelector(".list-container").innerHTML="",t.querySelector(".list-container").innerHTML="",i.querySelector(".list-container").innerHTML="",e.querySelector(".flag-container").innerHTML="",t.querySelector(".flag-container").innerHTML="",e.querySelector(".flag-container").innerHTML=""}function addMarkers(e,t,i,o){for(let a=0;a<e.length;a++){let r,n,s=e[a],l=s.isMine||s.isFriend?"#1E90FF":"#ea5a57";0==i?r={id:s.id,name:s.name,description:s.description,longitude:s.longitude,latitude:s.latitude,pictureId:s.pictureId}:1==i?r={id:s.placeId,name:s.placeName,description:s.placeDescription,longitude:s.placeLongitude,latitude:s.placeLatitude,pictureId:s.fileId}:2==i&&(r={id:s.residencePlaceId,name:s.residencePlaceName,description:s.residencePlaceDescription,longitude:s.residencePlaceLongitude,latitude:s.residencePlaceLatitude,pictureId:s.profilePhotoFileId}),(n=myearth.addMarker({mesh:"Marker",color:l,location:{lat:r.latitude,lng:r.longitude},scale:.01,offset:1.6,visible:!!r.id,transparent:!0,hotspotRadius:.6,hotspotHeight:1.25,photoInfo:s,place:r,isToDo:o,type:i})).addEventListener("click",()=>{stopPreviewMode(),openPhoto(n,o,i)}),setTimeout(()=>{n.animate("scale",markerScale,{duration:200}),n.animate("offset",0,{duration:1100,easing:"bounce"})},200*a),markerList.push(n);let c=document.createElement("div");if(c.classList.add("hidden"),c.classList.add("item"),0==i)c.dataset.placeid=s.id,c.innerHTML+="<div class='place-name'><b>"+s.name+"</b></div>";else if(1==i){let e=s.date;s.time&&(e+=", "+s.time),1!=s.statusEnum&&c.classList.add("deactive"),c.dataset.experienceid=s.id,c.innerHTML+="<div class='experience-name'><b>"+s.name+"</b></div>",c.innerHTML+="<address class='d-block experience-place'>"+s.placeName+"</address>",param_userId?c.innerHTML+="<small><time class='d-block experience-date' datetime='"+e+"'>"+e+"</time></small>":c.innerHTML+="<div class='d-block experience-user'>"+s.userNickname+"</div>"}else 2==i&&((1!=s.statusEnum||param_userId&&1!=s.friendStatusEnum)&&c.classList.add("deactive"),c.dataset.userid=s.id,c.innerHTML+="<div class='user-nickname'><b>"+s.nickname+"</b></div>",c.innerHTML+="<div class='user-name'>"+s.name+" "+s.surname+"</div>",s.residencePlaceName&&(c.innerHTML+="<address class='d-block user-residence'>"+s.residencePlaceName+"</address>"),s.birthDate&&(c.innerHTML+="<small><time class='d-block user-birthdate' datetime='"+s.birthDate+"'>"+s.birthDate+"</time></small>"));t.append(c),c.addEventListener("click",()=>{stopPreviewMode(),openPhoto(n,o,i),window.innerWidth<=screenWidthLimitMax&&closeExperiencePlacesClick()}),placeList.push(c),setTimeout(()=>{c.classList.remove("hidden")},200*a)}}function toggleExperiencePlacesClick(){document.body.classList.toggle("place-list-open"),document.body.classList.contains("place-list-open")||document.getElementById("experience-search").blur()}function closeExperiencePlacesClick(){document.body.classList.remove("place-list-open"),document.getElementById("experience-search").blur()}function openExperiencePlacesClick(){document.body.classList.add("place-list-open")}async function setPhoto(e,t,i,o){let a=document.querySelector("#photo"),r=a.querySelector("#photo-media-container"),n=a.querySelector("#photo-title");r.classList.add("loading");try{if(resetPhoto(),a){let i,a;if(0==o?(n.innerHTML="<img src='/images/icons/place.svg' alt='place' class='t-size mr-05' />"+t.name,i={id:null,fileType:"image/",fileName:t.name},a=await GetDefaultPlacePicture(t.id,!0)):1==o?(n.innerHTML="<img src='/images/icons/experiencemorning.svg' alt='experience' class='t-size mr-05' />"+e.name,i={id:e.fileId,fileType:e.fileType,fileName:e.fileName},a=await GetExperienceMedia(i.id,!0)):2==o&&(n.innerHTML="<img src='/images/icons/user_avatar_default.svg' alt='person' class='t-size mr-05' />"+e.nickname,e.profilePhotoFileId&&(i={id:e.profilePhotoFileId,fileType:e.profilePhotoFileType,fileName:e.profilePhotoFileName},a=await GetUserPicture(i.id,!0))),!i||!a)throw"Media not exists";if(i.fileType.startsWith("image/")){let e=document.createElement("img");e.classList.add("overlay-media"),e.setAttribute("id","overlay-img"),e.setAttribute("alt","media"),e.onerror=(e=>{onPhotoError(r,o,1,e)}),e.onload=(e=>{onPhotoSuccess(r,o,1,e)}),e.setAttribute("src",a)}else if(i.fileType.startsWith("video/")){let e=document.createElement("video");e.classList.add("overlay-media"),e.setAttribute("id","overlay-video"),e.setAttribute("alt","media"),e.autoplay=!0,e.muted=!0,e.onerror=(e=>{onPhotoError(r,o,2,e)}),e.onloadeddata=(e=>{onPhotoSuccess(r,o,2,e)}),e.setAttribute("src",a)}else{if(!i.fileType.startsWith("audio/"))throw"Media not supported";{let e=document.createElement("audio");e.classList.add("overlay-media"),e.setAttribute("id","overlay-audio"),e.setAttribute("alt","media"),e.autoplay=!0,e.muted=!0,e.onerror=(e=>{onPhotoError(r,o,3,e)}),e.onloadeddata=(e=>{onPhotoError(r,o,3,e)}),e.setAttribute("src",a)}}}}catch(e){throw onPhotoError(r,o),e}}function onPhotoError(e,t,i,o){e&&(e.innerHTML=2==t?"<img src='/images/icons/user_avatar_default.svg' alt='person' class='overlay-media' id='overlay-error' />":3==i?"<img src='/images/icons/audio_default.svg' alt='audio' class='overlay-media' id='overlay-error' />":"<img src='/images/icons/media_default.svg' alt='experience media error' class='overlay-media' id='overlay-error' />",setTimeout(()=>{e.classList.remove("loading")},200))}function onPhotoSuccess(e,t,i,o){e&&(e.appendChild(o.target),setTimeout(()=>{e.classList.remove("loading")},200))}async function openPhoto(e,t,i,o){if(startOpeningPhoto(),o||myearth.goTo(e.location,{relativeDuration:100}),e!=currentMarker){let o=document.querySelector(".earth-overlay #photo");currentMarker&&await closePhoto(),setPhoto(e.photoInfo,e.place,t,i),e.animate("scale",0,{duration:200}),mediaOverlay.location=e.location,mediaOverlay.visible=!0,currentMarker=e,0==i?document.querySelector("#place-list-container .item[data-placeid='"+e.photoInfo.id+"']").classList.add("active"):1==i?document.querySelector("#experience-list-container .item[data-experienceid='"+e.photoInfo.id+"']").classList.add("active"):2==i&&document.querySelector("#user-list-container .item[data-userid='"+e.photoInfo.id+"']").classList.add("active"),await sleep(200),o.classList.add("photo-appear")}o||(myearth.autoRotate=!1)}async function closePhotoClick(e){e.stopPropagation(),stopPreviewMode(),closePhoto(),window.dispatchEvent(new CustomEvent("startPreviewMode"))}async function closePhoto(){currentMarker&&(startClosingPhoto(),resetPhoto(),document.querySelector("#place-list-container .item.active")&&document.querySelector("#place-list-container .item.active").classList.remove("active"),document.querySelector("#experience-list-container .item.active")&&document.querySelector("#experience-list-container .item.active").classList.remove("active"),document.querySelector("#user-list-container .item.active")&&document.querySelector("#user-list-container .item.active").classList.remove("active"),await sleep(200),mediaOverlay.visible=!1,currentMarker&&(currentMarker.animate("scale",markerScale,{duration:200}),currentMarker.opacity=.7,currentMarker=!1),myearth.autoRotate=!0)}function photoClick(e){let t,i=document.querySelector("#photo");i.querySelector("#overlay-video")&&i.querySelector("#overlay-video").pause(),i.querySelector("#overlay-audio")&&i.querySelector("#overlay-audio").pause(),0==currentMarker.type?(t=viewUri+"Place?PlaceId="+currentMarker.photoInfo.id,param_userId&&(t+="&UserId="+param_userId),viewType&&(t+="&ViewTypeEnum="+viewTypeMap.findIndex(e=>e==viewType)),morningNight&&(t+="&MorningNightEnum="+morningNightMap.findIndex(e=>e==morningNight))):1==currentMarker.type?t=viewUri+"Experience?ExperienceId="+currentMarker.photoInfo.id:2==currentMarker.type&&(t=viewUri+"User?UserId="+currentMarker.photoInfo.id),window.location.href=t}function resetPhoto(){let e=document.querySelector("#photo");e&&(e.classList.remove("photo-appear"),e.style.backgroundImage=null,e.querySelector("#photo-title").innerHTML="",e.querySelector("#photo-media-container").innerHTML="")}window.addEventListener("earthjsload",()=>{myearth=new Earth(document.getElementById("myearth"),{location:{lat:16,lng:16},light:"none",lightAmbience:.2,mapLandColor:"#afd078",mapBorderColor:"#abcc74",mapSeaColor:"#34b9c4",mapBorderWidth:.3,mapStyles:"#GR, #ES, #PT, #PK, #MX, #PE, #AR, #BF, #ET, #GN, #SL, #LR, #CI, #GH, #TG, #BJ, #NG, #ZM, #AO, #RW, #BI, #TZ, #MW, #MZ { fill: #79b73a; stroke: #75b336; }         #GL, #IS, #AQ { fill: #e5e8ee; stroke: #e1e4ea; }         #SE, #NO, #FI, #MY, #ID, #JP, #CA, #GT, #HN, #SV, #NI, #GF, #SR, #GY, #SS, #CM, #GQ, #CF, #GA, #CG, #CD, #UG, #BR { fill: #69b73b; stroke: #65b337; }         #AU, #KE, #MG, #ZW, #TR, #IR, #KZ, #TJ, #KG, #AF, #CL, #MA, #ER, #DJ, #SO, #GM, #SN, #NA, #LS, #BW, #SZ, #ZA { fill: #97c75b; stroke: #93c357; }         #SY, #JO, #LB, #IL, #KW, #SA, #AE, #QA, #YE, #OM, #IQ, #UZ, #TM, #DZ, #TN, #EG, #SD, #ML, #LY, #EH, #MR, #NE, #TD { fill: #e6e18b; stroke: #e2dd87; }  ",quality:4,autoRotate:!0,scale:3,zoom:.7,zoomable:!1,zoomMin:.5,zoomMax:2}),myearth.addEventListener("change",()=>{try{let e=getMarkerScale();if(markerScale!=e&&(markerList.forEach(t=>{t.scale=e}),markerScale=e),myearth.zoom>=1.5&&(myearth.autoRotate=!1),myearth.zoom>=1.5?window.innerWidth>screenWidthLimitMax?mediaOverlay.elementScale=2:mediaOverlay.elementScale=1:window.innerWidth>screenWidthLimitMax?mediaOverlay.elementScale=1.5:mediaOverlay.elementScale=.5,!myearth.isOpeningPhoto)if(myearth.isPreviewMode){if(!myearth.isClosingPhoto&&currentMarker&&Earth.getAngle(myearth.location,currentMarker.location)>50&&closePhoto(),!currentMarker){let e=markerList.find(e=>Earth.getAngle(myearth.location,e.location)<=25);e&&openPhoto(e,e.isToDo,e.type,!0).then(()=>{myearth.autoRotate=!0})}}else currentMarker&&Earth.getAngle(myearth.location,currentMarker.location)>25&&closePhoto()}catch(e){console.error(e)}}),myearth.addEventListener("ready",async()=>{myearth.animate("lightAmbience",1,{duration:1500}),myearth.animate("zoom",1,{duration:1e3,complete:()=>{myearth.zoomable=!0}}),setHomeWorldViewSize(),markerScale=getMarkerScale(),mediaOverlay=myearth.addOverlay({content:'<div id="photo" onclick="photoClick(); event.stopPropagation();"><div id="photo-header"><h3 id="photo-title"></h3><img src="/images/icons/close.svg" alt="close" id="close-photo" onclick="closePhotoClick(event);" /></div><div id="photo-media-container"></div></div>',visible:!1,elementScale:1,depthScale:.5})})}),window.addEventListener("myOnPageLoad",async()=>{document.getElementById("experience-search").addEventListener("input",debounce(updateMarkers,300)),window.addEventListener("click",debounce(startPreviewMode,5e3)),window.addEventListener("touchstart",debounce(startPreviewMode,5e3)),window.addEventListener("startPreviewMode",debounce(startPreviewMode,5e3)),window.addEventListener("openingPhoto",debounce(finishOpeningPhoto,2e3)),window.addEventListener("closingPhoto",debounce(finishClosingPhoto,2e3));let e=new Hammer(document.getElementById("global-list-container"));e.on("swipeleft",e=>{closeExperiencePlacesClick()}),e.on("swiperight",e=>{openExperiencePlacesClick()}),myearth&&myearth.ready?init():myearth?myearth.addEventListener("ready",init):window.addEventListener("earthjsload",()=>{myearth.addEventListener("ready",init)})}),window.addEventListener("scroll",()=>{if(isHomeWorldViewScrollEnable){let e=window.scrollY,t=(document.body.offsetTop,document.getElementById("world-body-container").offsetTop);e>=t-t/2?isFirstWorldView?isInitCompleted?startWorldView():window.addEventListener("myOnInitCompleted",startWorldView):setWorldView():isFirstHomeView?isInitCompleted?startHomeView():window.addEventListener("myOnInitCompleted",startHomeView):setHomeView()}});